<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>lab</title>

    <style>
        #body h1:first-child{ font-size: 14px; font-weight:bold}
        a, a:visited {  text-decoration:none }
    </style>

  </head>
  <body style="background-color:#f7f7f7;">
    <div>
        <header>
            <h1 align="center"><a style="color: #333;" href="#!/index.md">lab</a></h1>
        </header>
        <div>
            <section id="body" >
                &gt; loading...
            </section>
        </div>
    </div>
    <script src="static/zepto.min.js"></script>
    <script src="static/marked.js"></script>
    <script>
        var stripUrl = function(url){
            var match = url.match(/#!(.+)$/);  
            return match ? match[1] : "/index.md";
        };
        var parseBody = function(body){
            $('#body').html(marked.parse(body));
            var title = $('#body>h1').text();   
            if(title) document.title = title;
            else document.title = page
        };
        var getPage = function(page){
            page = stripUrl(decodeURIComponent(page));
            $.ajax({
              type: "GET",
              url: "pages/"+page,
              success: parseBody,
              error: function(d) { parseBody("# 404\n页面丢了……"); }
            });
        };

        window.onhashchange = function(){
            $('#body').html('> loading...');
            getPage(location.hash);  
        };

        getPage(location.hash);
    </script>
  </body>
</html>
