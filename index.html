<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
      <meta name="apple-mobile-web-app-capable" content="yes">
      <meta name="format-detection" content="telephone=no">
      <meta content="telephone=no" name="format-detection">
      <link rel="stylesheet" type="text/css" href="static/page.css" />
      <title>V2U</title>
   </head>
   <body class="yue">
      <div class="header">
         <h1 class="page-title"><a href="/">V2U</a></h1>
         <div class="page-subtitle">「时间是最好的助手」</div>
      </div>
      <div class="content" id="content">
         <div class="entry">
            <div class="entry-bd" id="entry-bd">
               <p></p>
                &gt; loading...
            </div>
         </div>
      </div>
      <div class="footer">
         <div class="copyright"><span>&copy; 2017</span><a href="http://v2u.org">V2U</a><span>Theme By</span><a href="http://gaowhen.com">GaoWhen</a></div>
      </div>
      <script src="static/zepto.min.js"></script>
      <script src="static/remarkable.min.js"></script>
      <script>
          var md = new Remarkable('full', {
                html: true,
                linkify: false,
                breaks: true,
                typographer: true
          });
          var stripUrl = function(url){
              var match = url.match(/#!(.+)$/);  
              return match ? match[1] : false;
          };
          var parseBody = function(body){
              $('#entry-bd').html(md.render(body));
              var title = $('#entry-bd>h1').text();   
              if(title) {
                  document.title = title;
              }else {
                  document.title = location.hash;
              }
          };
          var getPage = function(page){
              page = stripUrl(decodeURIComponent(page));
              if(!page) return;

              $.ajax({
                type: "GET",
                url: "pages/"+page,
                success: parseBody,
                error: function(d) { parseBody("# 404\n页面丢了……"); }
              });
          };

          window.onhashchange = function(){
              $('#body').html('<p></p>> loading...');
              getPage(location.hash);  
          };

          var page = location.hash || '#!index.md';
          getPage(page);
      </script>
   </body>
</html>
